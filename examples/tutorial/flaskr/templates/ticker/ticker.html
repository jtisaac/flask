{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}Find ticker{% endblock %}</h1>
{% endblock %}

{% block content %}

  <form method="post">
    <label for="ticker_key">Ticker</label>
    <input name="ticker_key" id="ticker_key" value="{{ request.form['ticker_key'] }}" required>
    <input type="submit" value="Save">
  </form>

  <h1>test</h1>
  <!--<h1>{% block tickdat %}"{{ ticker_info }}"{% endblock %}</h1>-->

  <div id="chartdiv"></div>

  <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
  <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
  <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
  <script>
    console.log({{ticker_info | safe}}['series']['data'][0]['time']);
    var data = {{ticker_info | safe}}['series']['data'];
    console.log(typeof data[0]['price']);
    am4core.ready(function() {

    // Themes begin
    am4core.useTheme(am4themes_animated);
    // Themes end

    // Create chart instance
    var chart = am4core.create("chartdiv", am4charts.XYChart);

    // Add data
    chart.data = generateChartData();

    // Create axes
    var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
    dateAxis.renderer.minGridDistance = 50;

    var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());

    // Create series
    var series = chart.series.push(new am4charts.LineSeries());
    series.dataFields.valueY = "price";
    series.dataFields.dateX = "date";
    series.strokeWidth = 2;
    series.minBulletDistance = 10;
    series.tooltipText = "{valueY}";
    series.tooltip.pointerOrientation = "vertical";
    series.tooltip.background.cornerRadius = 20;
    series.tooltip.background.fillOpacity = 0.5;
    series.tooltip.label.padding(12,12,12,12)

    // Add scrollbar
    chart.scrollbarX = new am4charts.XYChartScrollbar();
    chart.scrollbarX.series.push(series);

    // Add cursor
    chart.cursor = new am4charts.XYCursor();
    chart.cursor.xAxis = dateAxis;
    chart.cursor.snapToSeries = series;

    function generateChartData() {
        var chartData = [];
        for (var i = 0; i < data.length; i++) {
            // we create date objects here. In your data, you can have date strings
            // and then set format of your dates using chart.dataDateFormat property,
            // however when possible, use date objects, as this will speed up chart rendering.
            var newDate = new Date(data[i]['time']);

            chartData.push({
                date: newDate,
                price: data[i]['price']
            });
        }
        console.log(chartData);
        return chartData;
    }

    }); // end am4core.ready()


  </script>

{% endblock %}
